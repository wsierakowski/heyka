<div class=\"recycle\">Article imported from <em>http://sierakowski.eu/javascript-tips/25-javascript-tips/118-using-modules-and-dependency-management-in-javascript-applications-with-amd-requirejs.html</em></div>
\r\n
<h3>Single-file car dealer shop application</h3>
\r\n<p style=\"text-align: justify;\">As the oversimplified sample application we are going to build a small car/bike dealer application. The dealer sells two type of vehicles, cars and bikes. As an owner of the dealer's shop we are able to buy a new item and put in on the stock or we can sell it and earn some money. All transactions are reflected in the bank account, when buying things we need to pay for them if we have enough money, when selling our earnings are deposited.</p>\r\n<p style=\"text-align: justify;\">For demonstration I decided to try to implement the functional inheritance pattern demonstrated in the \"JavaScript: The Good Parts\" book. We need items that we will be selling in the shop, so I created a base object called 'item' and both 'bike' and 'car' objects are extending it. Next we have the bank object that has a private variable named 'balance' and public methods that allow to deposit and withdraw our money. The initial deposit is set when creating a new bank object. The 'shop' object allows us to buy and sell items by adding or removing items from the stock and deducting or adding money to the bank. Finally at the end of the script file we initiate everything and buy and sell some items. Also to make it more complex, there is a dependency on the underscore.js library as we are going to use here and there.</p>\r\n
<p><em>scripts/app.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> item = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = <span style=\"color: #000000;\">{</span><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    spec.itemType = <span style=\"color: #990000;\">'item'</span>;</span>\r\n<span style=\"vertical-align: top;\">    spec.id = <span style=\"color: #000000; font-weight: bold;\">-</span><span style=\"color: #000000; font-weight: bold;\">1</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getItemType = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.itemType;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getId = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.id;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.setId = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>id<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        spec.id = id;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getColor = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.<span style=\"color: #004993;\">color</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getMake = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.make;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getSellingPrice = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.sellingPrice;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getPurchasePrice = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.purchasePrice;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> car = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = item<span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    spec.itemType = <span style=\"color: #990000;\">'car'</span>;</span>\r\n<span style=\"vertical-align: top;\">    spec.mileage = spec.mileage <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #990000;\">'n/a'</span>;</span>\r\n<span style=\"vertical-align: top;\">    spec.engineType = spec.engineType <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #990000;\">'n/a'</span>;</span>\r\n<span style=\"vertical-align: top;\">    spec.model = spec.model <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #990000;\">'n/a'</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getMileage = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.mileage;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getEngineType = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.engineType;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getModel = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.model;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> bike = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = item<span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    spec.itemType = <span style=\"color: #990000;\">'bike'</span>;</span>\r\n<span style=\"vertical-align: top;\">    spec.<span style=\"color: #004993;\">type</span> = spec.<span style=\"color: #004993;\">type</span> <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #990000;\">'n/a'</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> bank = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = <span style=\"color: #000000;\">{</span><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    spec.balance = spec.balance <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #000000; font-weight: bold;\">0</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getBalance = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.balance;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.withdraw = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>amount<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">if</span> <span style=\"color: #000000;\">(</span>spec.balance <span style=\"color: #000000; font-weight: bold;\">-</span> amount <span style=\"color: #000000; font-weight: bold;\">&gt;</span> <span style=\"color: #000000; font-weight: bold;\">0</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            spec.balance <span style=\"color: #000000; font-weight: bold;\">-</span>= amount;</span>\r\n<span style=\"vertical-align: top;\">            console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Bank: balance after withdrawal of'</span>, </span>\r\n<span style=\"vertical-align: top;\">                                amount, <span style=\"color: #990000;\">'is'</span>, spec.balance<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">true</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span></span>\r\n<span style=\"vertical-align: top;\">        console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Bank: unsuccesful withdrawal of'</span>, amount, <span style=\"color: #990000;\">', </span>\r\n<span style=\"vertical-align: top;\">                               current balance is'</span>, spec.balance<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">false</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.deposit = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>amount<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        spec.balance <span style=\"color: #000000; font-weight: bold;\">+</span>= amount;</span>\r\n<span style=\"vertical-align: top;\">        console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Bank: balance after deposit of'</span>, amount, <span style=\"color: #990000;\">'is'</span>, spec.balance<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> shop = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>myBank<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = <span style=\"color: #000000;\">{</span><span style=\"color: #000000;\">}</span>, stock = <span style=\"color: #000000;\">[</span><span style=\"color: #000000;\">]</span>, itemId = <span style=\"color: #000000; font-weight: bold;\">-</span><span style=\"color: #000000; font-weight: bold;\">1</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.getItemsOfType = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>itemType<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> _.<span style=\"color: #004993;\">filter</span><span style=\"color: #000000;\">(</span>stock, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getItemType<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> === itemType;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.buyItem = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">if</span> <span style=\"color: #000000;\">(</span>myBank.withdraw<span style=\"color: #000000;\">(</span>item.getPurchasePrice<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            item.setId<span style=\"color: #000000;\">(</span><span style=\"color: #000000; font-weight: bold;\">++</span>itemId<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            stock.<span style=\"color: #004993;\">push</span><span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item added to the stock (id:'</span>, item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000; font-weight: bold;\">+</span> <span style=\"color: #990000;\">')'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span></span>\r\n \r\n<span style=\"vertical-align: top;\">        console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Not enough savings to buy this item'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">null</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    that.sellItem = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>id<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #6699cc; font-weight: bold;\">var</span> item = _.find<span style=\"color: #000000;\">(</span>stock, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> === id;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">if</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            stock.<span style=\"color: #004993;\">splice</span><span style=\"color: #000000;\">(</span>stock.<span style=\"color: #004993;\">indexOf</span><span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span>, <span style=\"color: #000000; font-weight: bold;\">1</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            myBank.deposit<span style=\"color: #000000;\">(</span>item.getSellingPrice<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item with id '</span>, id, <span style=\"color: #990000;\">' sold'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> id;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span></span>\r\n \r\n<span style=\"vertical-align: top;\">        console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item with id '</span>, id, <span style=\"color: #990000;\">'not in stock'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">null</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #3f5fbf;\">/* ----------------------- */</span></span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #6699cc; font-weight: bold;\">var</span> myBank = bank<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span>balance<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">10000</span><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>,</span>\r\n<span style=\"vertical-align: top;\">    myShop = shop<span style=\"color: #000000;\">(</span>myBank<span style=\"color: #000000;\">)</span>,</span>\r\n<span style=\"vertical-align: top;\">    itemIds = <span style=\"color: #000000;\">[</span><span style=\"color: #000000;\">]</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #009900;\">// add something to the shop's stock</span></span>\r\n<span style=\"vertical-align: top;\">itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">0</span><span style=\"color: #000000;\">]</span> = myShop.buyItem<span style=\"color: #000000;\">(</span>car<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">2300</span>,</span>\r\n<span style=\"vertical-align: top;\">    purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">2000</span>,</span>\r\n<span style=\"vertical-align: top;\">    make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'VW'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'silver'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mileage         <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">100000</span>,</span>\r\n<span style=\"vertical-align: top;\">    engineType      <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'1.9 diesel'</span>,</span>\r\n<span style=\"vertical-align: top;\">    model           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'Passat'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">1</span><span style=\"color: #000000;\">]</span> = myShop.buyItem<span style=\"color: #000000;\">(</span>car<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">8000</span>,</span>\r\n<span style=\"vertical-align: top;\">    purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">6500</span>,</span>\r\n<span style=\"vertical-align: top;\">    make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'Audi'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'black'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mileage         <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">55000</span>,</span>\r\n<span style=\"vertical-align: top;\">    engineType      <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'2.5 petrol'</span>,</span>\r\n<span style=\"vertical-align: top;\">    model           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'A4'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">2</span><span style=\"color: #000000;\">]</span> = myShop.buyItem<span style=\"color: #000000;\">(</span>bike<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">800</span>,</span>\r\n<span style=\"vertical-align: top;\">    purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">750</span>,</span>\r\n<span style=\"vertical-align: top;\">    make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'romet'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'yellow'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">type</span>            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'mountain'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">3</span><span style=\"color: #000000;\">]</span> = myShop.buyItem<span style=\"color: #000000;\">(</span>car<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">800</span>,</span>\r\n<span style=\"vertical-align: top;\">    purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">700</span>,</span>\r\n<span style=\"vertical-align: top;\">    make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'Fiat'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'red'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mileage         <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">170000</span>,</span>\r\n<span style=\"vertical-align: top;\">    engineType      <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'1.2 petrol'</span>,</span>\r\n<span style=\"vertical-align: top;\">    model           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'Punto'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">myShop.buyItem<span style=\"color: #000000;\">(</span>bike<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">500</span>,</span>\r\n<span style=\"vertical-align: top;\">    purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">450</span>,</span>\r\n<span style=\"vertical-align: top;\">    make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'noname'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'green'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">type</span>            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'city'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #009900;\">// what is my current balance?</span></span>\r\n<span style=\"vertical-align: top;\">console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'My current bank account balance: '</span>, myBank.getBalance<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #009900;\">// time to sell something and start earning money!</span></span>\r\n<span style=\"vertical-align: top;\">myShop.sellItem<span style=\"color: #000000;\">(</span>itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">1</span><span style=\"color: #000000;\">]</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">myShop.sellItem<span style=\"color: #000000;\">(</span>itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">2</span><span style=\"color: #000000;\">]</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #009900;\">// what is my current balance?</span></span>\r\n<span style=\"vertical-align: top;\">console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'My current bank account balance: '</span>, myBank.getBalance<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>And <em>index.html:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/underscore.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/app.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>Here is a screenshot of the executed script.</p>
\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase0_browser.png\" alt=\"phase0_browser.png\" /></p>
\r\n
<h3>Breaking modules down into individual script files</h3>
\r\n<p style=\"text-align: justify;\">The first improvement that we can make is to break the modules into individual js files, so item module would go to the items/item.js, the same for items/car.js, items/bike.js, app/shop.js and app/bank.js. The main.js file has the code running the shop that is taken from the end of the app.js file. We don't need the app.js anymore.</p>\r\n
<p>The folder structure now looks like this:</p>
\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase1_filestructure.png\" alt=\"phase1_filestructure.png\" /></p>
\r\n
<p>We need to make a change to the <em>index.html file</em>:</p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/libs/underscore.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/items/item.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/items/car.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/items/bike.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/app/shop.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/app/bank.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"scripts/main.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">If we test it again, it should work the same as it was working before with just a single script file.</p>\r\n<p style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase1_browser_ok.png\" alt=\"phase1_browser_ok.png\" /></p>\r\n<p style=\"text-align: justify;\">But what would happen if we changed the order of the script tags and moved main.js one line up above the bank.js?</p>\r\n<p style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase1_browser_notok.png\" alt=\"phase1_browser_notok.png\" /></p>\r\n<p style=\"text-align: justify;\">We broke the dependency order, because the main.js references the bank.js that wasn't loaded yet, the uncaught reference error is thrown. Of course in simple applications these dependencies are quite easy to manage, but imagine applications that consist of tens if not hundreds of different dependencies and modules.</p>\r\n<p style=\"text-align: justify;\">&nbsp;</p>\r\n<h3 style=\"text-align: justify;\">Wrapping modules into require.js AMD type modules</h3>\r\n<p style=\"text-align: justify;\">With AMD we can avoid all of that. The first thing that we need to do is to wrap our modules in the define function callbacks and the main file using these modules in the require wrapper.</p>\r\n<p style=\"text-align: justify;\">This is the item.js after wrapping in the define function, the content is literary copied and pasted inside of the callback function that is the first and only parameter to the define and the item object is returned from it. This structure is required to let other modules using it.</p>\r\n
<p><em>scripts/items/item.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">define<span style=\"color: #000000;\">(</span><span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> item = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = <span style=\"color: #000000;\">{</span><span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        spec.itemType = <span style=\"color: #990000;\">'item'</span>;</span>\r\n<span style=\"vertical-align: top;\">        spec.id = <span style=\"color: #000000; font-weight: bold;\">-</span><span style=\"color: #000000; font-weight: bold;\">1</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getItemType = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.itemType;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getId = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.id;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.setId = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>id<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            spec.id = id;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getColor = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.<span style=\"color: #004993;\">color</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getMake = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.make;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getSellingPrice = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.sellingPrice;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getPurchasePrice = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> spec.purchasePrice;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> item;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">Because the bike.js and the car.js depend on the item.js, in the define method we additionally add that 'item' dependency. Note that an array with a string representing a name of the dependency is passed as the first parameter to the define method and then again as a parameter to the callback function that now became the second parameter of the define. Here is the bike.js example, the car.js is done in the similar way:</p>\r\n
<p><em>scripts/items/bike.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">define<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">[</span><span style=\"color: #990000;\">'item'</span><span style=\"color: #000000;\">]</span>, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> bike = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = item<span style=\"color: #000000;\">(</span>spec<span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        spec.itemType = <span style=\"color: #990000;\">'bike'</span>;</span>\r\n<span style=\"vertical-align: top;\">        spec.<span style=\"color: #004993;\">type</span> = spec.<span style=\"color: #004993;\">type</span> <span style=\"color: #000000; font-weight: bold;\">||</span> <span style=\"color: #990000;\">'n/a'</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> bike;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">The bank.js would be wrapped in the same way as the item.js as it doesn't depend on any other module. But the shop.js is the module that has more dependencies as it depends on the car, the bike and the underscore library.</p>\r\n
<p><em>scripts/app/shop.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">define<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">[</span><span style=\"color: #990000;\">'underscore'</span>, <span style=\"color: #990000;\">'car'</span>, <span style=\"color: #990000;\">'bike'</span><span style=\"color: #000000;\">]</span>, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>_, car, bike<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> shop = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>myBank<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #6699cc; font-weight: bold;\">var</span> that = <span style=\"color: #000000;\">{</span><span style=\"color: #000000;\">}</span>, stock = <span style=\"color: #000000;\">[</span><span style=\"color: #000000;\">]</span>, itemId = <span style=\"color: #000000; font-weight: bold;\">-</span><span style=\"color: #000000; font-weight: bold;\">1</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.getItemsOfType = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>itemType<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> _.<span style=\"color: #004993;\">filter</span><span style=\"color: #000000;\">(</span>stock, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">                <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getItemType<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> === itemType;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.buyItem = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">if</span> <span style=\"color: #000000;\">(</span>myBank.withdraw<span style=\"color: #000000;\">(</span>item.getPurchasePrice<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">                item.setId<span style=\"color: #000000;\">(</span><span style=\"color: #000000; font-weight: bold;\">++</span>itemId<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                stock.<span style=\"color: #004993;\">push</span><span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item added to the stock (id:'</span>, item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> <span style=\"color: #000000; font-weight: bold;\">+</span> <span style=\"color: #990000;\">')'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #000000;\">}</span></span>\r\n \r\n<span style=\"vertical-align: top;\">            console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Not enough savings to buy this item'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">null</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        that.sellItem = <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>id<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #6699cc; font-weight: bold;\">var</span> item = _.find<span style=\"color: #000000;\">(</span>stock, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">                <span style=\"color: #0033ff; font-weight: bold;\">return</span> item.getId<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span> === id;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">if</span> <span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">                stock.<span style=\"color: #004993;\">splice</span><span style=\"color: #000000;\">(</span>stock.<span style=\"color: #004993;\">indexOf</span><span style=\"color: #000000;\">(</span>item<span style=\"color: #000000;\">)</span>, <span style=\"color: #000000; font-weight: bold;\">1</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                myBank.deposit<span style=\"color: #000000;\">(</span>item.getSellingPrice<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item with id '</span>, id, <span style=\"color: #990000;\">' sold'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">                <span style=\"color: #0033ff; font-weight: bold;\">return</span> id;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #000000;\">}</span></span>\r\n \r\n<span style=\"vertical-align: top;\">            console.<span style=\"color: #004993;\">log</span><span style=\"color: #000000;\">(</span><span style=\"color: #990000;\">'Item with id '</span>, id, <span style=\"color: #990000;\">'not in stock'</span><span style=\"color: #000000;\">)</span>;</span>\r\n<span style=\"vertical-align: top;\">            <span style=\"color: #0033ff; font-weight: bold;\">return</span> <span style=\"color: #0033ff; font-weight: bold;\">null</span>;</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">        <span style=\"color: #0033ff; font-weight: bold;\">return</span> that;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>;</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #0033ff; font-weight: bold;\">return</span> shop;</span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">Now let's have a look at the main.js. This is our main application file that launches the application. Instead of wrapping in the define function, we wrap it into the require. We also add a config definition to specify the base folder and paths to different modules. Because the underscore library is not wrapped in the AMD compatible wrapper, we need to use a workaround to import it correctly (shim). The require function is similar in structure to define, as the first parameter we pass an array of dependencies and the second parameter is a callback that takes module names as the parameters. We do not return anything from the require callback.</p>\r\n
<p><em>scripts/main.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">require.config<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    paths<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        item<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'items/item'</span>,</span>\r\n<span style=\"vertical-align: top;\">        bike<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'items/bike'</span>,</span>\r\n<span style=\"vertical-align: top;\">        car<span style=\"color: #000000; font-weight: bold;\">:</span>  <span style=\"color: #990000;\">'items/car'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">        bank<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'app/bank'</span>,</span>\r\n<span style=\"vertical-align: top;\">        shop<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'app/shop'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">        underscore<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'libs/underscore'</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    shim<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        underscore<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            exports<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'_'</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">require<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">[</span><span style=\"color: #990000;\">'shop'</span>, <span style=\"color: #990000;\">'bank'</span>, <span style=\"color: #990000;\">'car'</span>, <span style=\"color: #990000;\">'bike'</span><span style=\"color: #000000;\">]</span>, <span style=\"color: #339966; font-weight: bold;\">function</span> <span style=\"color: #000000;\">(</span>shop, bank, car, bike<span style=\"color: #000000;\">)</span> <span style=\"color: #000000;\">{</span></span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #6699cc; font-weight: bold;\">var</span> myBank = bank<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span>balance<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">10000</span><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>,</span>\r\n<span style=\"vertical-align: top;\">        myShop = shop<span style=\"color: #000000;\">(</span>myBank<span style=\"color: #000000;\">)</span>,</span>\r\n<span style=\"vertical-align: top;\">        itemIds = <span style=\"color: #000000;\">[</span><span style=\"color: #000000;\">]</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #009900;\">// add something to the shop's stock</span></span>\r\n<span style=\"vertical-align: top;\">    itemIds<span style=\"color: #000000;\">[</span><span style=\"color: #000000; font-weight: bold;\">0</span><span style=\"color: #000000;\">]</span> = myShop.buyItem<span style=\"color: #000000;\">(</span>car<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        sellingPrice    <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">2300</span>,</span>\r\n<span style=\"vertical-align: top;\">        purchasePrice   <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">2000</span>,</span>\r\n<span style=\"vertical-align: top;\">        make            <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'VW'</span>,</span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #004993;\">color</span>           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'silver'</span>,</span>\r\n<span style=\"vertical-align: top;\">        mileage         <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000; font-weight: bold;\">100000</span>,</span>\r\n<span style=\"vertical-align: top;\">        engineType      <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'1.9 diesel'</span>,</span>\r\n<span style=\"vertical-align: top;\">        model           <span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'Passat'</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span><span style=\"color: #000000;\">)</span>;</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #3f5fbf;\">/*</span>\r\n \r\n<span style=\"vertical-align: top;\">    ...</span>\r\n \r\n<span style=\"vertical-align: top;\">    */</span></span>\r\n \r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">The last thing to get our application working again is to modify the index.html file, there is no need to load all these different js script files anymore. We don't need to remember about order in which we need to load scripts as well - all this is managed for us automatically. The only script tag links to the require.js itself but it also has data-main attribute that points the require to the main script, note that there is no need to put the \"js\" extension at the end.</p>\r\n
<p><em>index.html:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script data<span style=\"color: #000000; font-weight: bold;\">-</span>main=<span style=\"color: #990000;\">\"scripts/main\"</span> src=<span style=\"color: #990000;\">\"scripts/libs/require.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>The files structure looks like this now:</p>
\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase1_filestructure_require.png\" alt=\"phase1_filestructure_require.png\" /></p>
\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">And the application should execute in the same way as before we wrapped it into the AMD modules with requuire.js.</p>\r\n<p style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase1_browser_require.png\" alt=\"phase1_browser_require.png\" /></p>\r\n<p style=\"text-align: justify;\"><a class=\"download\" href=\"http://sierakowski.eu/examples/requirejs/phase1.zip\">&lt;phase1.zip&gt;</a></p>\r\n<p style=\"text-align: justify;\">&nbsp;</p>\r\n
<h3>Optimising with r.js</h3>
\r\n<p style=\"text-align: justify;\">Our application is broken into modules so it is easier for us developers to maintain and extend it. But having many different separate module files isn't a good thing for a user, browsers will need to make multiple network request to load all the modules. This isn't very problematic with a small application, but it may become an overhead with large scale applications depending on hundreds of different modules. The solution is to merge our modules into a single file. This is good for us as during the development we would still use separate files, that then would be merged during the build process (locally or on the continuous integration server) and from the end user's perspective there will be only one js file loaded with a single request from a browser.</p>\r\n<p style=\"text-align: justify;\">For combining modules into one file we will use the r.js \"adapter\" that also includes the optimiser - all that is developed by the same team that works on the require.js project. Apart from just combining, the optimiser can also minify the script with UglifyJS. Full documentation of using the require optimizer is available here: http://requirejs.org/docs/optimization.html.</p>\r\n<p style=\"text-align: justify;\">The r.js script can be run in a browser but I prefer to use it with Node.js as a part of the build process. To prepare our application for building, let's create a new build configuration file build.js. It is not required as we could pass build properties as options when executing the build process in the command line but it is certainly easier to manage it this way. In the build.js we specify the location of the run-time configuration file (that we will just create in a moment), name of the main application file (main.js in our case), location for the output (processed) file that will be in the \"build\" folder and finally I set the optimisation parameter to none for now as we want to see first how the combined modules look like without \"minificating\" it. Let's call this build file \"build-dev\" as it will not be optimised for production - not minified/uglified and all code comments will be kept there.</p>\r\n
<p><em>build-dev.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mainConfigFile<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/config.js'</span>,</span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">name</span><span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"main\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    out<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"build/dealerapp-dev.js\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    optimize<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'none'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">I also moved the require.config from the main.js to a separate file config.js (this file is called the runtime config file).</p>\r\n
<p><em>scripts/config.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">require.config<span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    paths<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        item<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'items/item'</span>,</span>\r\n<span style=\"vertical-align: top;\">        bike<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'items/bike'</span>,</span>\r\n<span style=\"vertical-align: top;\">        car<span style=\"color: #000000; font-weight: bold;\">:</span>  <span style=\"color: #990000;\">'items/car'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">        bank<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'app/bank'</span>,</span>\r\n<span style=\"vertical-align: top;\">        shop<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'app/shop'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">        underscore<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'libs/underscore'</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    shim<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        underscore<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">            exports<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'_'</span></span>\r\n<span style=\"vertical-align: top;\">        <span style=\"color: #000000;\">}</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span>;</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<div style=\"text-align: justify;\">This is how the current code structure looks like at the moment:</div>\r\n<div style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase2_filestructure.png\" alt=\"phase2_filestructure.png\" /></div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">So we are ready to run the script. In the terminal, in the root of our project folder, run this command:</p>\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\">node r.js <span style=\"color: #000000; font-weight: bold;\">-</span>o build-dev.js</span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">If everything is in place correctly you should be able to see a result like below:</p>\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase2_terminal_norequire.png\" alt=\"phase2_terminal_norequire.png\" /></p>
\r\n<p style=\"text-align: justify;\">But what is most important, the build file is placed in the build folder, so let's have a look at it. As you can see this is just pure merge of our modules, the underscore lib comes first and the other modules follow it.</p>\r\n<p style=\"text-align: justify;\">&nbsp;</p>\r\n
<p><a class=\"download\" href=\"http://sierakowski.eu/examples/requirejs/phase2_1/dealerapp-dev.js\">&lt;phase2_1/dealerapp-dev.js&gt;</a></p>
\r\n
<p>&nbsp;</p>
\r\n
<p>So let's link our index.html directly to this file and see how it works:</p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000; font-weight: bold;\">&lt;</span>script src=<span style=\"color: #990000;\">\"build/dealerapp-dev.js\"</span><span style=\"color: #000000; font-weight: bold;\">&gt;&lt;/</span>script<span style=\"color: #000000; font-weight: bold;\">&gt;</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>Of course you should see an error like this:</p>
\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase2_browser_defineerror.png\" alt=\"phase2_browser_defineerror.png\" /></p>
\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">We didn't add the require.js library as one of the dependencies! Let's update the build-dev.js file by adding a path to the require.js script file (property is named \"requireLib\" as \"require\" word is already reserved):</p>\r\n
<p><em>build-dev.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mainConfigFile<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/config.js'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    paths<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        requireLib<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'libs/require'</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    include<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">[</span><span style=\"color: #990000;\">'requireLib'</span><span style=\"color: #000000;\">]</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">name</span><span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"main\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    out<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"build/dealerapp-dev.js\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    optimize<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'none'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">Now when you run the build script again, you will notice that require.js is added at the top. If you refresh your browser, this time the page should launch correctly.</p>\r\n<p style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase2_terminal_require.png\" alt=\"phase2_terminal_require.png\" /></p>\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase2_browser_withdefine.png\" alt=\"phase2_browser_withdefine.png\" /></p>
\r\n<p style=\"text-align: justify;\">Once we learned how to combine multiple module files and how to get the output script running, let's have a look how to optimise it with the r.js \"adapter\". Let's create another build script - build.js and copy the entire content of the build-dev.js excluding the line optimize: false and change the out property to export the file to dealerapp.js.</p>\r\n
<p><em>build.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mainConfigFile<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/config.js'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    paths<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">        requireLib<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'libs/require'</span></span>\r\n<span style=\"vertical-align: top;\">    <span style=\"color: #000000;\">}</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    include<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #000000;\">[</span><span style=\"color: #990000;\">'requireLib'</span><span style=\"color: #000000;\">]</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">name</span><span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"main\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    out<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"build/dealerapp.js\"</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n<p style=\"text-align: justify;\">When we run our script we should see an additional line about uglifying dealerapp.js.</p>\r\n<p style=\"text-align: justify;\"><img src=\"http://sierakowski.eu/examples/requirejs/phase2_terminal_require_optimisation.png\" alt=\"phase2_terminal_require_optimisation.png\" /></p>\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase2_browser_optimised.png\" alt=\"phase2_browser_optimised.png\" /></p>
\r\n<p style=\"text-align: justify;\">The main script file became now a 'one liner', from 101 KB dealerapp-dev.js we managed to get 33 KB in our production code and still our application works perfectly.</p>\r\n<p style=\"text-align: justify;\">&nbsp;</p>\r\n
<p><a class=\"download\" href=\"http://sierakowski.eu/examples/requirejs/phase2_2.zip\">&lt;phase2.zip&gt;</a></p>
\r\n
<p>&nbsp;</p>
\r\n
<h3>Almond</h3>
\r\n
<p>The majority of the content of the combined file is now the require.js script. It contains functionality that we don't need, we just want to be able to load and run our AMD modules. Luckily there is another AMD loader that is a lot smaller and contains only necessary functionality - almond.js <a href=\"https://github.com/jrburke/almond\" target=\"_blank\">https://github.com/jrburke/almond</a>, a library from James Burke - the same guy that stay behind the require.js library. Download it and place in the libs folder in place of the require.js file.</p>
\r\n
<p>We need to slightly modify our build files, the build-dev.js and build.js, first remove references to the require.js and then instead of having 'main' in the name property we add a path to almond.js (without 'js') and the reference to 'main' will go to the 'include' property.</p>
\r\n
<p><em>build-dev.js:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mainConfigFile<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/config.js'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">name</span><span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"libs/almond\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    include<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"main\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    out<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"build/dealerapp-dev.js\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    optimize<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'none'</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>We follow the same approach for the <em>build.js file:</em></p>
\r\n
<div class=\"rj_insertcode\">
  \r\n
  <div class=\"rj_insertcode_actionscript3\">\r\n<div class=\"actionscript3\" style=\"border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;\">\r\n<pre style=\"margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;\"><span style=\"vertical-align: top;\"><span style=\"color: #000000;\">(</span><span style=\"color: #000000;\">{</span></span>\r\n<span style=\"vertical-align: top;\">    baseUrl<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/'</span>,</span>\r\n<span style=\"vertical-align: top;\">    mainConfigFile<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">'scripts/config.js'</span>,</span>\r\n \r\n<span style=\"vertical-align: top;\">    <span style=\"color: #004993;\">name</span><span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"libs/almond\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    include<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"main\"</span>,</span>\r\n<span style=\"vertical-align: top;\">    out<span style=\"color: #000000; font-weight: bold;\">:</span> <span style=\"color: #990000;\">\"build/dealerapp.js\"</span></span>\r\n<span style=\"vertical-align: top;\"><span style=\"color: #000000;\">}</span><span style=\"color: #000000;\">)</span></span></pre>\r\n</div>
  \r\n
</div>
\r\n</div>\r\n
<p>&nbsp;</p>
\r\n
<p>So let's run the r.js optimisation tool in terminal:</p>
\r\n
<p><img src=\"http://sierakowski.eu/examples/requirejs/phase3_almondoptimisation.png\" alt=\"phase3_almondoptimisation.png\" /></p>
\r\n
<p>If we run the application in a browser, it runs in exactly the same way as before with the require.js. Let's compare file sizes after optimising with the require.js loader and the almond.js loader:</p>
\r\n
<p><strong>Require.js:</strong></p>
\r\n
<p>dealerapp-dev.js 99 KB<br />dealerapp.js 32 KB</p>
\r\n
<p>&nbsp;</p>
\r\n
<p><strong>Almond.js:</strong></p>
\r\n
<p>dealerapp-dev.js 32 KB<br />dealerapp.js 18 KB</p>
\r\n
<p>&nbsp;</p>
\r\n
<p><a class=\"download\" href=\"http://sierakowski.eu/examples/requirejs/phase3.zip\">&lt;phase3.zip&gt;</a></p>
\r\n
<p>&nbsp;</p>
\r\n
<p>&nbsp;</p>
\r\n
<p>TBD</p>
\r\n
<p>&nbsp;</p>
\r\n
<p>...</p>
\r\n
<p></p>
\r\n
<div id=\"jc\">
  \r\n
  <div id=\"comments\">
    \r\n
    <h4>Comments imported from the original article @sierakowski.eu</h4>
    \r\n
    <div id=\"comments-list\" class=\"comments-list\">
      \r\n
      <div id=\"comment-item-190\" class=\"even\">
        \r\n
        <div class=\"rbox\">
          \r\n
          <div class=\"rbox_tr\">
            \r\n
            <div class=\"rbox_tl\">
              \r\n
              <div class=\"rbox_t\">&nbsp;</div>
              \r\n
            </div>
            \r\n
          </div>
          \r\n
          <div class=\"rbox_m\">
            \r\n
            <div class=\"comment-box usertype-guest\">
              <span class=\"comments-vote\"> <span id=\"comment-vote-holder-189\"> <a class=\"vote-good\" title=\"Good comment!\">+</a><a class=\"vote-poor\" title=\"Poor comment!\">-</a> <span class=\"vote-none\">0</span> </span> </span> <a class=\"comment-anchor\">#2</a> <span class=\"comment-author\">Vladimir</span> <span class=\"comment-date\">2013-07-19 18:20</span>\r\n
              <div id=\"comment-body-190\" class=\"comment-body\">Good stuff.</div>
              \r\n<span class=\"comments-buttons\"> <a>Quote</a> </span>
            </div>
            \r\n
            <div class=\"clear\">&nbsp;</div>
            \r\n
          </div>
          \r\n
          <div class=\"rbox_br\">
            \r\n
            <div class=\"rbox_bl\">
              \r\n
              <div class=\"rbox_b\">&nbsp;</div>
              \r\n
            </div>
            \r\n
          </div>
          \r\n
        </div>
        \r\n
      </div>
      \r\n
      <div id=\"comment-item-190\" class=\"even\">
        \r\n
        <div class=\"rbox\">
          \r\n
          <div class=\"rbox_tr\">
            \r\n
            <div class=\"rbox_tl\">
              \r\n
              <div class=\"rbox_t\">&nbsp;</div>
              \r\n
            </div>
            \r\n
          </div>
          \r\n
          <div class=\"rbox_m\">
            \r\n
            <div class=\"comment-box usertype-guest\">
              <span class=\"comments-vote\"> <span id=\"comment-vote-holder-189\"> <a class=\"vote-good\" title=\"Good comment!\">+</a><a class=\"vote-poor\" title=\"Poor comment!\">-</a> <span class=\"vote-none\">0</span> </span> </span> <a class=\"comment-anchor\">#1</a> <span class=\"comment-author\">szczypior</span> <span class=\"comment-date\">2013-07-11 21:14</span>\r\n
              <div id=\"comment-body-190\" class=\"comment-body\">Thanks for this tutorial. There aren't many examples on the internet on how to use require practically. Require.js documentations is comprehensive but not easy to understand at first.</div>
              \r\n<span class=\"comments-buttons\"> <a>Quote</a> </span>
            </div>
            \r\n
            <div class=\"clear\">&nbsp;</div>
            \r\n
          </div>
          \r\n
          <div class=\"rbox_br\">
            \r\n
            <div class=\"rbox_bl\">
              \r\n
              <div class=\"rbox_b\">&nbsp;</div>
              \r\n
            </div>
            \r\n
          </div>
          \r\n
        </div>
        \r\n
      </div>
      \r\n
    </div>
    \r\n
  </div>
  \r\n
</div>
