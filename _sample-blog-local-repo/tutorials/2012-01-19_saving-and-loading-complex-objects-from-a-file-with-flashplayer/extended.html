<div class="recycle">Article imported from <em>http://sierakowski.eu/list-of-tips/110-saving-and-loading-complex-objects-from-a-file-with-flashplayer.html</em></div>
<p style="text-align: justify;">So I was working on an educational application for teachers and one of the requirements was that they should have an option to load and save data to a file what would allow them exchanging data files between themselves. Amount of data was rather huge
    as among other data it consisted of x and y coordinates representing drawings done on a special canvas. I created a class containing public properties representing these x and y values stored in an array and other information like color and thickness
    of a stroke. Every time a user creates a new line, a new object of that class is being created and stored in an array, let's call it main array. When pressed a save button, that main array is serialised using JSON library, this means it is represented
    in a form of string. I also create another string containing information about the version of the application, date when the data is being exported and title of the export that a teacher provides when clicking the save button. Next using these strings
    and their lengths values I'm creating and populating a byte array. Before saving I'm also compressing it to minimise a file size and finally whole content of the byte array is being saved to a file. Loading a file is a very similar operation with
    all the steps reversed ;). Enough talking, let's have a look to the code, all important things are commented to give you a better explanation. Bear in mind that this is not a complete code to copy and paste as I just provide here pieces illustrating
    the whole idea.</p>
<p style="text-align: justify;">This is a class that stores information about each drawing. I put it here to show you what sort of objects you could serialise and save to a file.</p>
<div class="rj_insertcode">
    <div class="rj_insertcode_actionscript3">
        <div class="actionscript3" style="border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #009900;">//note that all properties are public allowing JSON class to get access to them</span></span>
<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">internal</span> <span style="color: #9900cc; font-weight: bold;">class</span> ActionPen</span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> actionId<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=uint%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:uint.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">uint</span></a>; <span style="color: #009900;">//each drawing has unique action id</span></span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> toolType<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>;</span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> <span style="color: #004993;">color</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>;</span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> thicness<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>;</span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> points<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=array%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:array.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Array</span></a>;</span>

<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> ActionPen<span style="color: #000000;">(</span>actionId<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=uint%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:uint.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">uint</span></a>, <span style="color: #004993;">color</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>, <span style="color: #004993;">thickness</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;">  <span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">    <span style="color: #0033ff; font-weight: bold;">this</span>.actionId = actionId;</span>
<span style="vertical-align: top;">    <span style="color: #0033ff; font-weight: bold;">this</span>.toolType = ActionsRecorder.ATOOL_PEN;</span>
<span style="vertical-align: top;">    <span style="color: #0033ff; font-weight: bold;">this</span>.<span style="color: #004993;">color</span> = <span style="color: #004993;">color</span>;</span>
<span style="vertical-align: top;">    <span style="color: #0033ff; font-weight: bold;">this</span>.thicness = <span style="color: #004993;">thickness</span>;</span>
<span style="vertical-align: top;">    points = <span style="color: #000000;">[</span><span style="color: #000000;">]</span>;</span>
<span style="vertical-align: top;">  <span style="color: #000000;">}</span></span>

<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> addAction<span style="color: #000000;">(</span><span style="color: #004993;">x</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>, <span style="color: #004993;">y</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;">  <span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">    points.<span style="color: #004993;">push</span><span style="color: #000000;">(</span><span style="color: #0033ff; font-weight: bold;">new</span> <a href="http://www.google.com/search?q=point%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:point.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Point</span></a><span style="color: #000000;">(</span><span style="color: #004993;">x</span>, <span style="color: #004993;">y</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">  <span style="color: #000000;">}</span></span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span>

<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">internal</span> <span style="color: #9900cc; font-weight: bold;">class</span> <a href="http://www.google.com/search?q=point%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:point.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Point</span></a></span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #6699cc; font-weight: bold;">var</span> <span style="color: #004993;">x</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>, <span style="color: #004993;">y</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>;</span>
<span style="vertical-align: top;">  <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> <a href="http://www.google.com/search?q=point%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:point.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Point</span></a><span style="color: #000000;">(</span><span style="color: #004993;">x</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a>, <span style="color: #004993;">y</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">int</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span> <span style="color: #000000;">{</span><span style="color: #0033ff; font-weight: bold;">this</span>.<span style="color: #004993;">x</span> = <span style="color: #004993;">x</span>; <span style="color: #0033ff; font-weight: bold;">this</span>.<span style="color: #004993;">y</span> = <span style="color: #004993;">y</span>;<span style="color: #000000;">}</span>;</span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span></pre>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<p style="text-align: justify;">Then another class calles ActionsRecorder has a property mActionsArray containing instances of the ActionPen class and methods to serialise and de-serialise this data. To keep things simple I'm not providing the classes to create or recreate the ActionPen
    objects with drawing data here. As for JSON, if you are going to use build methods to the FP11 (and you should as there are more opitimal than as3corelib's JSON), use JSON.parse() instead of decode and JSON.stringify() instead of encode.</p>
<div class="rj_insertcode">
    <div class="rj_insertcode_actionscript3">
        <div class="actionscript3" style="border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #009900;">//if you use fp11 you don't need to use as3core lib</span></span>
<span style="vertical-align: top;"><span style="color: #009900;">//as JSON is built in already.</span></span>
<span style="vertical-align: top;"><span style="color: #009900;">//if you are targetting for fp10 then use this import</span></span>
<span style="vertical-align: top;"><span style="color: #009900;">//and get http://code.google.com/p/as3corelib/</span></span>
<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">import</span> com.adobe.serialization.json.JSON;</span>

<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #9900cc; font-weight: bold;">class</span> ActionsRecorder</span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//this array keeps instances of the ActionPen class</span></span>
<span style="vertical-align: top;">   <span style="color: #0033ff; font-weight: bold;">private</span> <span style="color: #6699cc; font-weight: bold;">var</span> mActionsArray<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=array%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:array.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Array</span></a>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//using JSON to encode array of ActionPen objects</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//along with all properties</span></span>
<span style="vertical-align: top;">   <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> actionsExport<span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a></span>
<span style="vertical-align: top;">   <span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">      <span style="color: #0033ff; font-weight: bold;">return</span> JSON.encode<span style="color: #000000;">(</span>mActionsArray<span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   <span style="color: #000000;">}</span></span>

<span style="vertical-align: top;">   <span style="color: #009900;">//again using JSON to decode string read from a file</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//and cast is as an array. This way we are rebuilding</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//also all the object it contained.</span></span>
<span style="vertical-align: top;">   <span style="color: #0033ff; font-weight: bold;">public</span> <span style="color: #339966; font-weight: bold;">function</span> actionsImport<span style="color: #000000;">(</span><span style="color: #004993;">data</span><span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;">   <span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">      mActionsArray = <span style="color: #0033ff; font-weight: bold;">null</span>;</span>
<span style="vertical-align: top;">      mActionsArray = JSON.<span style="color: #004993;">decode</span><span style="color: #000000;">(</span><span style="color: #004993;">data</span><span style="color: #000000;">)</span> <span style="color: #0033ff; font-weight: bold;">as</span> <a href="http://www.google.com/search?q=array%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:array.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Array</span></a>;</span>
<span style="vertical-align: top;">      mRepeatIndex = <span style="color: #000000; font-weight: bold;">0</span>;</span>
<span style="vertical-align: top;">   <span style="color: #000000;">}</span></span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span></pre>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<p>JSON encoded version of the mActionsArray would look like this:</p>
<div class="rj_insertcode">
    <div class="rj_insertcode_actionscript3">
        <div class="actionscript3" style="border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #000000;">[</span><span style="color: #000000;">{</span><span style="color: #990000;">"thicness"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">5</span>,<span style="color: #990000;">"actionId"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">0</span>,<span style="color: #990000;">"points"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000;">[</span><span style="color: #000000;">{</span><span style="color: #990000;">"y"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">112</span>,<span style="color: #990000;">"x"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">226</span><span style="color: #000000;">}</span>,<span style="color: #000000;">{</span><span style="color: #990000;">"y"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">113</span>,<span style="color: #990000;">"x"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">226</span><span style="color: #000000;">}</span>,</span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span><span style="color: #990000;">"y"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">116</span>,<span style="color: #990000;">"x"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">226</span><span style="color: #000000;">}</span>,<span style="color: #000000;">{</span><span style="color: #990000;">"y"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">131</span>,<span style="color: #990000;">"x"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">226</span><span style="color: #000000;">}</span>,<span style="color: #000000;">{</span><span style="color: #990000;">"y"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">149</span>,<span style="color: #990000;">"x"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">226</span><span style="color: #000000;">}</span><span style="color: #000000;">]</span>,</span>
<span style="vertical-align: top;"><span style="color: #990000;">"toolType"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">0</span>,<span style="color: #990000;">"color"</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #000000; font-weight: bold;">3355443</span><span style="color: #000000;">}</span><span style="color: #000000;">]</span></span></pre>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<p style="text-align: justify;">Next in the other part of the application I keep method to use export string from ActionsRecorder to save it to a file and another method to read it from a file and send it to ActionsRecorder to import it. There are two important things to note here,
    one is that Flash Player can't automatically save or read from a file. Methods that are creating file reference objects are required to receive the MouseEvent in order to get access to a file system. The second restriction is that you can't specify
    any folder where that file is to be saved, it will be defaulted to a desktop and user will need to manually select a location in a browse window. Both are caused by security reasons, just imagine what would happen if your app created an exe file and
    saved it in the startup folder or accessed operating system configuration files without letting the user know about it. Forcing to use MouseEvent, the user has control that there is something being saved or opened for some reason.</p>
<p style="text-align: justify;">So somewhere on the stage there are two buttons for import and export and here are the methods that are event handlers for them. First let's have a look on saving:</p>
<div class="rj_insertcode">
    <div class="rj_insertcode_actionscript3">
        <div class="actionscript3" style="border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #009900;">//for both saving and loading you are going to need this import:</span></span>
<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">import</span> <span style="color: #004993;">flash.net</span>.<a href="http://www.google.com/search?q=filefilter%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filefilter.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileFilter</span></a>;</span>
<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">import</span> <span style="color: #004993;">flash.utils</span>.<a href="http://www.google.com/search?q=bytearray%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:bytearray.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">ByteArray</span></a>;</span>

<span style="vertical-align: top;"><span style="color: #339966; font-weight: bold;">function</span> saveToFile<span style="color: #000000;">(</span>e<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=mouseevent%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:mouseevent.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">MouseEvent</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//here I'm getting a string which is a json encoded array of ActionPen objects</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> exportString<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = ActionsRecorder.getInstance<span style="color: #000000;">(</span><span style="color: #000000;">)</span>.actionsExport<span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//this is some additional data for my application in case in the future </span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//we release a never version with more type export data </span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> fileHeader<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = APP_NAME <span style="color: #000000; font-weight: bold;">+</span> <span style="color: #990000;">" v"</span> <span style="color: #000000; font-weight: bold;">+</span> APP_VER;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//also saving export data, which will be shown in the import window later on</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> exportDate<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = getDateString<span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//here I'm creating a string for a file name</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> fileName<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = <span style="color: #990000;">"export_"</span> <span style="color: #000000; font-weight: bold;">+</span> getDateString<span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000000; font-weight: bold;">+</span> <span style="color: #990000;">".dat"</span>;</span>

<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> ba<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=bytearray%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:bytearray.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">ByteArray</span></a> = <span style="color: #0033ff; font-weight: bold;">new</span> <a href="http://www.google.com/search?q=bytearray%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:bytearray.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">ByteArray</span></a><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//for each piece of separate data I'm saving first a number representing</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//length of a string using writeShort where Short is a 16-bit integer</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//and then an actual string with writeUTFBytes and passing length as an argument..</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//This way I will be able to read correct data later on when importing it.</span></span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeShort</span><span style="color: #000000;">(</span>fileHeader.<span style="color: #004993;">length</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeUTFBytes</span><span style="color: #000000;">(</span>fileHeader<span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeShort</span><span style="color: #000000;">(</span>exportDate.<span style="color: #004993;">length</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeUTFBytes</span><span style="color: #000000;">(</span>exportDate<span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeShort</span><span style="color: #000000;">(</span>exportString.<span style="color: #004993;">length</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">writeUTFBytes</span><span style="color: #000000;">(</span>exportString<span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//once all data is in byte array it's time to compress it</span></span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">compress</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span></span>

<span style="vertical-align: top;">   <span style="color: #009900;">//creating file reference and calling save method which opens browse dialog</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//where user can select a destination for a file.</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> f<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=filereference%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filereference.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileReference</span></a> = <span style="color: #0033ff; font-weight: bold;">new</span> <a href="http://www.google.com/search?q=filereference%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filereference.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileReference</span></a><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   f.<span style="color: #004993;">save</span><span style="color: #000000;">(</span>ba, fileName<span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span></pre>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<p><span style="line-height: 26px;">And for loading in addition for a mouse handler method for import button we also have another one for loading data:</span></p>
<div class="rj_insertcode">
    <div class="rj_insertcode_actionscript3">
        <div class="actionscript3" style="border-collapse: collapse; width: 100%; border: 1px solid #054b6e; background: #f8f8f8;">
            <pre style="margin: 0; background: none; vertical-align: top; padding: 0px 4px; font-size: 12px;"><span style="vertical-align: top;"><span style="color: #009900;">//additional import to filter out files in open dialog box</span></span>
<span style="vertical-align: top;"><span style="color: #0033ff; font-weight: bold;">import</span> <span style="color: #004993;">flash.net</span>.<a href="http://www.google.com/search?q=filefilter%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filefilter.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileFilter</span></a>;</span>

<span style="vertical-align: top;"><span style="color: #339966; font-weight: bold;">function</span> openFromFile<span style="color: #000000;">(</span>e<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=mouseevent%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:mouseevent.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">MouseEvent</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> f<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=filereference%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filereference.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileReference</span></a> = <span style="color: #0033ff; font-weight: bold;">new</span> <a href="http://www.google.com/search?q=filereference%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filereference.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileReference</span></a><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//when user completes selecting a file to load we call file load</span></span>
<span style="vertical-align: top;">   f.<span style="color: #004993;">addEventListener</span><span style="color: #000000;">(</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Event</span></a>.<span style="color: #004993;">SELECT</span>, <span style="color: #339966; font-weight: bold;">function</span><span style="color: #000000;">(</span>e<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Event</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span><span style="color: #000000;">{</span>f.<span style="color: #004993;">load</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;<span style="color: #000000;">}</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//when file loading is complete...</span></span>
<span style="vertical-align: top;">   f.<span style="color: #004993;">addEventListener</span><span style="color: #000000;">(</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Event</span></a>.<span style="color: #004993;">COMPLETE</span>, onFileLoadComplete<span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//creating file filter for open dialog box with description "MyApp export files"</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//and default extension of .dat</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> fFilter<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=filefilter%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filefilter.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileFilter</span></a> = <span style="color: #0033ff; font-weight: bold;">new</span> <a href="http://www.google.com/search?q=filefilter%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:filefilter.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">FileFilter</span></a><span style="color: #000000;">(</span><span style="color: #990000;">"MyApp export files"</span>, <span style="color: #990000;">"*.dat"</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//actual call to a browse method invoking browse window with array of file filters</span></span>
<span style="vertical-align: top;">   f.<span style="color: #004993;">browse</span><span style="color: #000000;">(</span><span style="color: #000000;">[</span>fFilter<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span>

<span style="vertical-align: top;"><span style="color: #339966; font-weight: bold;">function</span> onFileLoadComplete<span style="color: #000000;">(</span>e<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">Event</span></a><span style="color: #000000;">)</span><span style="color: #000000; font-weight: bold;">:</span><span style="color: #0033ff; font-weight: bold;">void</span></span>
<span style="vertical-align: top;"><span style="color: #000000;">{</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//file loaded so let's parse the data</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> ba<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=bytearray%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:bytearray.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">ByteArray</span></a> = e.<span style="color: #004993;">target</span>.<span style="color: #004993;">data</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//first we need to uncompress it</span></span>
<span style="vertical-align: top;">   ba.<span style="color: #004993;">uncompress</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//and read in reverse order we saved them.</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//For each piece of data we first read Short which is a number representing</span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//a length of a string and then an actual string (UTFBytes)</span></span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> fileHeader<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = ba.<span style="color: #004993;">readUTFBytes</span><span style="color: #000000;">(</span>ba.<span style="color: #004993;">readShort</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> exportDate<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = ba.<span style="color: #004993;">readUTFBytes</span><span style="color: #000000;">(</span>ba.<span style="color: #004993;">readShort</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;">   <span style="color: #6699cc; font-weight: bold;">var</span> exportString<span style="color: #000000; font-weight: bold;">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html&amp;filter=0&amp;num=100&amp;btnI=lucky"><span style="color: #004993;">String</span></a> = ba.<span style="color: #004993;">readUTFBytes</span><span style="color: #000000;">(</span>ba.<span style="color: #004993;">readShort</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</span>

<span style="vertical-align: top;">   <span style="color: #009900;">//exportString is what we send back to the ActionsRecorder to </span></span>
<span style="vertical-align: top;">   <span style="color: #009900;">//recreate the ActionPen objects</span></span>
<span style="vertical-align: top;">   ActionsRecorder.getInstance<span style="color: #000000;">(</span><span style="color: #000000;">)</span>.actionsImport<span style="color: #000000;">(</span>exportString<span style="color: #000000;">)</span>;</span>
<span style="vertical-align: top;"><span style="color: #000000;">}</span></span></pre>
        </div>
    </div>
</div>
<p>&nbsp;</p>
<p>So that's it. Of course the final code would have some data validation to make sure that data imported is correct. It could be an additional integer in byte array with a total number of bytes. If these two values didn't match we would know that something
    wrong happened to the file.</p>
<p>And here is a simple example how this looks in practice. First populate the array (represented by the list component) and export to a file. Next you can refresh the page and import the file to see the list populated again. Also open the saved file in
    a file editor to have a look at the binary content.</p>
<p><object data="http://sierakowski.eu/examples/saveBinToFile/saveToFileWithMinimalComps.swf " type="application/x-shockwave-flash" width="400" height="250"><param name="src" value="http://sierakowski.eu/examples/saveBinToFile/saveToFileWithMinimalComps.swf " />
</object></p>
<p>&nbsp;</p>
<p></p>
<div id="jc">
    <div id="comments">
        <h4>Comments imported from the original article @sierakowski.eu</h4>
        <div id="comments-list" class="comments-list">
            <div id="comment-item-190" class="even">
                <div class="rbox">
                    <div class="rbox_tr">
                        <div class="rbox_tl">
                            <div class="rbox_t">&nbsp;</div>
                        </div>
                    </div>
                    <div class="rbox_m">
                        <div class="comment-box usertype-guest"><span class="comments-vote"> <span id="comment-vote-holder-189"> <a class="vote-good" title="Good comment!">+</a><a class="vote-poor" title="Poor comment!">-</a> <span class="vote-none">0</span> </span>
                            </span> <a class="comment-anchor">#2</a> <span class="comment-author">Fabian</span> <span class="comment-date">2014-02-02 00:35</span>
                            <div id="comment-body-197" class="comment-body">2 years ago....super tutorial. thanks for the post. I&acute;m using it now, but i encounter a problem.<br />My exportString is too long. I get an "Error: Error #2030: End of file was encountered. at flash.utils::ByteArra y/readUTFBytes()"<br
                                /><br />How can i fix this?</div>
                            <span class="comments-buttons"> <a>Quote</a> </span></div>
                        <div class="clear">&nbsp;</div>
                    </div>
                    <div class="rbox_br">
                        <div class="rbox_bl">
                            <div class="rbox_b">&nbsp;</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="comment-item-190" class="even">
                <div class="rbox">
                    <div class="rbox_tr">
                        <div class="rbox_tl">
                            <div class="rbox_t">&nbsp;</div>
                        </div>
                    </div>
                    <div class="rbox_m">
                        <div class="comment-box usertype-guest"><span class="comments-vote"> <span id="comment-vote-holder-189"> <a class="vote-good" title="Good comment!">+</a><a class="vote-poor" title="Poor comment!">-</a> <span class="vote-good">+2</span> </span>
                            </span> <a class="comment-anchor">#1</a> <span class="comment-author">Junior dev</span> <span class="comment-date">2012-06-17 13:16</span>
                            <div id="comment-body-190" class="comment-body">Awesome tutorial, thanks for sharing it.</div>
                            <span class="comments-buttons"> <a>Quote</a> </span></div>
                        <div class="clear">&nbsp;</div>
                    </div>
                    <div class="rbox_br">
                        <div class="rbox_bl">
                            <div class="rbox_b">&nbsp;</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
